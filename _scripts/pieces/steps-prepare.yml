- uses: actions/checkout@v3
  with:
      ref: "master"

- uses: cachix/install-nix-action@v17
  with:
      nix_path: "nixpkgs=channel:nixpkgs-unstable"

- name: "Install tools"
  run: |
      nix-env -f '<nixpkgs>' -iA 'nix-build-uncached' 'fish'

- name: "Change TMPDIR for nix daemon"
  run: |
      fish _scripts/set-tmpdir.fish

- name: "Update flake"
  run: |
      nix flake update

- uses: cachix/cachix-action@v10
  with:
      name: "nuirrce"
      authToken: "${{ secrets.CACHIX_AUTH_TOKEN }}"
      cachixArgs: "-j8 -c5"
      pushFilter: |
          (NVIDIA.*\.run)|(-source)

